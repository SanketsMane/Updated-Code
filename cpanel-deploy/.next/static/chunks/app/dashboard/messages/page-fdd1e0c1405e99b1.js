(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5342],{5760:(e,s,a)=>{"use strict";a.d(s,{p:()=>n});var t=a(72311);a(62847);var r=a(98443);function n(e){let{className:s,type:a,...n}=e;return(0,t.jsx)("input",{suppressHydrationWarning:!0,type:a,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...n})}},9812:(e,s,a)=>{"use strict";a.d(s,{Cf:()=>u,Es:()=>x,L3:()=>h,c7:()=>m,lG:()=>l,rr:()=>f,zM:()=>d});var t=a(72311);a(62847);var r=a(44884),n=a(19258),i=a(98443);function l(e){let{...s}=e;return(0,t.jsx)(r.bL,{"data-slot":"dialog",...s})}function d(e){let{...s}=e;return(0,t.jsx)(r.l9,{"data-slot":"dialog-trigger",...s})}function o(e){let{...s}=e;return(0,t.jsx)(r.ZL,{"data-slot":"dialog-portal",...s})}function c(e){let{className:s,...a}=e;return(0,t.jsx)(r.hJ,{"data-slot":"dialog-overlay",className:(0,i.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...a})}function u(e){let{className:s,children:a,showCloseButton:l=!0,...d}=e;return(0,t.jsxs)(o,{"data-slot":"dialog-portal",children:[(0,t.jsx)(c,{}),(0,t.jsxs)(r.UC,{"data-slot":"dialog-content",className:(0,i.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...d,children:[a,l&&(0,t.jsxs)(r.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,t.jsx)(n.A,{}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"dialog-header",className:(0,i.cn)("flex flex-col gap-2 text-center sm:text-left",s),...a})}function x(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"dialog-footer",className:(0,i.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),...a})}function h(e){let{className:s,...a}=e;return(0,t.jsx)(r.hE,{"data-slot":"dialog-title",className:(0,i.cn)("text-lg leading-none font-semibold",s),...a})}function f(e){let{className:s,...a}=e;return(0,t.jsx)(r.VY,{"data-slot":"dialog-description",className:(0,i.cn)("text-muted-foreground text-sm",s),...a})}},13598:(e,s,a)=>{Promise.resolve().then(a.bind(a,97555))},14189:(e,s,a)=>{"use strict";a.d(s,{E:()=>n});var t=a(72311),r=a(98443);function n(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"skeleton",className:(0,r.cn)("bg-accent animate-pulse rounded-md",s),...a})}},14271:(e,s,a)=>{"use strict";a.d(s,{F:()=>l});var t=a(72311),r=a(62847),n=a(43436),i=a(98443);let l=r.forwardRef((e,s)=>{let{className:a,children:r,...l}=e;return(0,t.jsxs)(n.bL,{ref:s,className:(0,i.cn)("relative overflow-hidden",a),...l,children:[(0,t.jsx)(n.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,t.jsx)(d,{}),(0,t.jsx)(n.OK,{})]})});l.displayName=n.bL.displayName;let d=r.forwardRef((e,s)=>{let{className:a,orientation:r="vertical",...l}=e;return(0,t.jsx)(n.VM,{ref:s,orientation:r,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...l,children:(0,t.jsx)(n.lr,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=n.VM.displayName},33788:(e,s,a)=>{"use strict";a.d(s,{$:()=>d,r:()=>l});var t=a(72311);a(62847);var r=a(37448),n=a(32560),i=a(98443);let l=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:s,variant:a,size:n,asChild:d=!1,...o}=e,c=d?r.DX:"button";return(0,t.jsx)(c,{suppressHydrationWarning:!0,"data-slot":"button",className:(0,i.cn)(l({variant:a,size:n,className:s})),...o})}},56398:(e,s,a)=>{"use strict";a.d(s,{BT:()=>d,Wu:()=>o,ZB:()=>l,Zp:()=>n,aR:()=>i});var t=a(72311);a(62847);var r=a(98443);function n(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...a})}function i(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...a})}function l(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",s),...a})}function d(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",s),...a})}function o(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",s),...a})}},80085:(e,s,a)=>{"use strict";a.d(s,{E:()=>d});var t=a(72311);a(62847);var r=a(37448),n=a(32560),i=a(98443);let l=(0,n.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function d(e){let{className:s,variant:a,asChild:n=!1,...d}=e,o=n?r.DX:"span";return(0,t.jsx)(o,{"data-slot":"badge",className:(0,i.cn)(l({variant:a}),s),...d})}},86243:(e,s,a)=>{"use strict";a.d(s,{Avatar:()=>i,AvatarFallback:()=>d,AvatarImage:()=>l});var t=a(72311);a(62847);var r=a(48260),n=a(98443);function i(e){let{className:s,...a}=e;return(0,t.jsx)(r.bL,{"data-slot":"avatar",className:(0,n.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",s),...a})}function l(e){let{className:s,...a}=e;return(0,t.jsx)(r._V,{"data-slot":"avatar-image",className:(0,n.cn)("aspect-square size-full",s),...a})}function d(e){let{className:s,...a}=e;return(0,t.jsx)(r.H4,{"data-slot":"avatar-fallback",className:(0,n.cn)("bg-muted flex size-full items-center justify-center rounded-full",s),...a})}},97555:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>N});var t=a(72311),r=a(62847),n=a(33788),i=a(5760),l=a(56398),d=a(86243),o=a(80085),c=a(14189),u=a(3060),m=a(20138),x=a(12086),h=a(44466),f=a(86638),v=a(17947),g=a(6252),p=a(55627),j=a(9812),b=a(14271);function N(){let[e,s]=(0,r.useState)([]),[a,N]=(0,r.useState)(null),[y,w]=(0,r.useState)([]),[k,A]=(0,r.useState)(""),[C,S]=(0,r.useState)(""),[z,E]=(0,r.useState)([]),[_,P]=(0,r.useState)(!1),[F,O]=(0,r.useState)(!0),[M,T]=(0,r.useState)(!1),I=(0,r.useRef)(null);(0,r.useEffect)(()=>{L()},[]),(0,r.useEffect)(()=>{a&&($(a),fetch("/api/messages/conversations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"markAsRead",conversationId:a})}))},[a]),(0,r.useEffect)(()=>{D()},[y]);let L=async()=>{try{let e=await fetch("/api/messages/conversations"),t=await e.json();s(t),t.length>0&&!a&&N(t[0].id)}catch(e){console.error("Error loading conversations:",e)}finally{O(!1)}},$=async e=>{try{let s=await fetch("/api/messages/conversations?conversationId=".concat(e)),a=await s.json();w(a)}catch(e){console.error("Error loading messages:",e)}},V=async e=>{if(e.preventDefault(),k.trim()&&a&&!M){T(!0);try{await fetch("/api/messages/conversations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"sendMessage",conversationId:a,message:k.trim()})}),A(""),await $(a),await L()}catch(e){console.error("Error sending message:",e)}finally{T(!1)}}},U=async e=>{if(S(e),e.trim().length<2)return void E([]);try{let s=await fetch("/api/messages/conversations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"searchUsers",query:e})}),a=await s.json();E(a)}catch(e){console.error("Error searching users:",e)}},W=async e=>{try{let s=await fetch("/api/messages/conversations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"createConversation",userId:e})}),a=await s.json();P(!1),S(""),E([]),await L(),N(a.id)}catch(e){console.error("Error starting conversation:",e)}},D=()=>{var e;null==(e=I.current)||e.scrollIntoView({behavior:"smooth"})},J=e.find(e=>e.id===a);return F?(0,t.jsxs)("div",{className:"h-full flex",children:[(0,t.jsx)("div",{className:"w-1/3 border-r",children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)(c.E,{className:"h-10 w-full mb-4"}),(0,t.jsx)("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(c.E,{className:"h-10 w-10 rounded-full"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(c.E,{className:"h-4 w-3/4 mb-2"}),(0,t.jsx)(c.E,{className:"h-3 w-1/2"})]})]},s))})]})}),(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(u.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading messages..."})]})})]}):(0,t.jsxs)("div",{className:"h-full flex bg-background",children:[(0,t.jsxs)("div",{className:"w-1/3 border-r flex flex-col",children:[(0,t.jsx)("div",{className:"p-4 border-b",children:(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Messages"}),(0,t.jsxs)(j.lG,{open:_,onOpenChange:P,children:[(0,t.jsx)(j.zM,{asChild:!0,children:(0,t.jsxs)(n.$,{size:"sm",variant:"outline",children:[(0,t.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"New Chat"]})}),(0,t.jsxs)(j.Cf,{children:[(0,t.jsx)(j.c7,{children:(0,t.jsx)(j.L3,{children:"Start New Conversation"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(x.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(i.p,{placeholder:"Search users by name or email...",value:C,onChange:e=>U(e.target.value),className:"pl-10"})]}),(0,t.jsx)(b.F,{className:"h-64",children:(0,t.jsxs)("div",{className:"space-y-2",children:[z.map(e=>(0,t.jsx)(l.Zp,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>W(e.id),children:(0,t.jsx)(l.Wu,{className:"p-3",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)(d.Avatar,{className:"h-10 w-10",children:[(0,t.jsx)(d.AvatarImage,{src:e.image||""}),(0,t.jsx)(d.AvatarFallback,{children:e.name.charAt(0).toUpperCase()})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.email}),e.teacherProfile&&(0,t.jsx)("p",{className:"text-xs text-blue-600",children:"Teacher"})]})]})})},e.id)),C.length>=2&&0===z.length&&(0,t.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No users found"})]})})]})]})]})]})}),(0,t.jsx)(b.F,{className:"flex-1",children:(0,t.jsx)("div",{className:"p-2",children:0===e.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(u.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"No conversations yet"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Start a new chat to begin messaging"})]}):(0,t.jsx)("div",{className:"space-y-1",children:e.map(e=>(0,t.jsx)(l.Zp,{className:"cursor-pointer transition-colors ".concat(a===e.id?"bg-primary/10 border-primary":"hover:bg-muted/50"),onClick:()=>N(e.id),children:(0,t.jsx)(l.Wu,{className:"p-3",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsxs)(d.Avatar,{className:"h-10 w-10",children:[(0,t.jsx)(d.AvatarImage,{src:e.otherParticipant.image||""}),(0,t.jsx)(d.AvatarFallback,{children:e.otherParticipant.name.charAt(0).toUpperCase()})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("p",{className:"font-medium truncate",children:e.otherParticipant.name}),e.unreadCount>0&&(0,t.jsx)(o.E,{variant:"destructive",className:"text-xs",children:e.unreadCount})]}),e.lastMessage&&(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.lastMessage.content}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,p.m)(new Date(e.lastMessage.createdAt),{addSuffix:!0})})]})]})]})})},e.id))})})})]}),(0,t.jsx)("div",{className:"flex-1 flex flex-col",children:a&&J?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"p-4 border-b bg-background",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)(d.Avatar,{className:"h-10 w-10",children:[(0,t.jsx)(d.AvatarImage,{src:J.otherParticipant.image||""}),(0,t.jsx)(d.AvatarFallback,{children:J.otherParticipant.name.charAt(0).toUpperCase()})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-medium",children:J.otherParticipant.name}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Active now"})]}),(0,t.jsx)(n.$,{variant:"ghost",size:"sm",children:(0,t.jsx)(h.A,{className:"h-4 w-4"})})]})}),(0,t.jsx)(b.F,{className:"flex-1 p-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[y.map((e,s)=>{var a;let r=e.sender.id!==J.otherParticipant.id,n=s===y.length-1||(null==(a=y[s+1])?void 0:a.sender.id)!==e.sender.id;return(0,t.jsx)("div",{className:"flex ".concat(r?"justify-end":"justify-start"," ").concat(n?"mb-4":"mb-1"),children:(0,t.jsxs)("div",{className:"flex ".concat(r?"flex-row-reverse":"flex-row"," items-end space-x-2 max-w-[70%]"),children:[n&&!r&&(0,t.jsxs)(d.Avatar,{className:"h-6 w-6",children:[(0,t.jsx)(d.AvatarImage,{src:e.sender.image||""}),(0,t.jsx)(d.AvatarFallback,{className:"text-xs",children:e.sender.name.charAt(0).toUpperCase()})]}),(0,t.jsxs)("div",{className:"rounded-lg px-3 py-2 ".concat(r?"bg-primary text-primary-foreground":"bg-muted"),children:[(0,t.jsx)("p",{className:"text-sm",children:e.content}),(0,t.jsx)("p",{className:"text-xs mt-1 ".concat(r?"text-primary-foreground/70":"text-muted-foreground"),children:(0,p.m)(new Date(e.createdAt),{addSuffix:!0})})]}),n&&!r&&(0,t.jsx)("div",{className:"w-6"})]})},e.id)}),(0,t.jsx)("div",{ref:I})]})}),(0,t.jsx)("div",{className:"p-4 border-t",children:(0,t.jsxs)("form",{onSubmit:V,className:"flex items-end space-x-2",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(i.p,{value:k,onChange:e=>A(e.target.value),placeholder:"Type a message...",disabled:M})}),(0,t.jsx)(n.$,{type:"button",variant:"ghost",size:"sm",disabled:M,children:(0,t.jsx)(f.A,{className:"h-4 w-4"})}),(0,t.jsx)(n.$,{type:"button",variant:"ghost",size:"sm",disabled:M,children:(0,t.jsx)(v.A,{className:"h-4 w-4"})}),(0,t.jsx)(n.$,{type:"submit",disabled:!k.trim()||M,children:(0,t.jsx)(g.A,{className:"h-4 w-4"})})]})})]}):(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(u.A,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Welcome to Messages"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"Select a conversation to start messaging, or create a new one."}),(0,t.jsxs)(n.$,{onClick:()=>P(!0),children:[(0,t.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Start New Conversation"]})]})})})]})}},98443:(e,s,a)=>{"use strict";a.d(s,{cn:()=>n});var t=a(37246),r=a(18327);function n(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return(0,r.QP)((0,t.$)(s))}}},e=>{var s=s=>e(e.s=s);e.O(0,[2760,8425,1932,3293,5422,4509,5627,8952,5789,6020,7358],()=>s(13598)),_N_E=e.O()}]);