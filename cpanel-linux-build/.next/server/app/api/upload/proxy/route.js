"use strict";(()=>{var e={};e.id=7308,e.ids=[7308],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{e.exports=require("node:buffer")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14985:e=>{e.exports=require("dns")},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},37067:e=>{e.exports=require("node:http")},44708:e=>{e.exports=require("node:https")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47706:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>h,serverHooks:()=>y,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>q});var o={};t.r(o),t.d(o,{POST:()=>f});var s=t(36639),n=t(99880),a=t(77991),i=t(60901),p=t(49522),u=t(94149),d=t(91043),l=t(43831),x=t(11246),c=t(84143);async function f(e){try{let r=await p.j.api.getSession({headers:await (0,l.headers)()});if(!r||"admin"!==r.user.role&&"teacher"!==r.user.role)return x.NextResponse.json({error:"Unauthorized"},{status:401});let t=(await e.formData()).get("file");if(!t)return x.NextResponse.json({error:"No file provided"},{status:400});if(!t.type.startsWith("image/"))return x.NextResponse.json({error:"Only images are allowed via this proxy"},{status:400});let o=Buffer.from(await t.arrayBuffer()),s=t.name,n=`${(0,c.A)()}-${s}`,a=new d.PutObjectCommand({Bucket:u._.NEXT_PUBLIC_S3_BUCKET_NAME_IMAGES,Key:n,Body:o,ContentType:t.type});return await i.S3.send(a),x.NextResponse.json({key:n,url:`https://${u._.NEXT_PUBLIC_S3_BUCKET_NAME_IMAGES}.fly.storage.tigris.dev/${n}`})}catch(e){return console.error("Proxy Upload Error:",e),x.NextResponse.json({error:"Upload failed"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/upload/proxy/route",pathname:"/api/upload/proxy",filename:"route",bundlePath:"app/api/upload/proxy/route"},resolvedPagePath:"/Users/sanket/Documents/LMS-Organomed copy/app/api/upload/proxy/route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:m,workUnitAsyncStorage:q,serverHooks:y}=h;function g(){return(0,a.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:q})}},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{e.exports=require("zlib")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},81630:e=>{e.exports=require("http")},84143:(e,r,t)=>{t.d(r,{A:()=>p});var o=t(55511);let s={randomUUID:o.randomUUID},n=new Uint8Array(256),a=n.length,i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let p=function(e,r,t){if(s.randomUUID&&!r&&!e)return s.randomUUID();let p=(e=e||{}).random??e.rng?.()??(a>n.length-16&&((0,o.randomFillSync)(n),a=0),n.slice(a,a+=16));if(p.length<16)throw Error("Random bytes length must be >= 16");if(p[6]=15&p[6]|64,p[8]=63&p[8]|128,r){if((t=t||0)<0||t+16>r.length)throw RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let e=0;e<16;++e)r[t+e]=p[e];return r}return function(e,r=0){return(i[e[r+0]]+i[e[r+1]]+i[e[r+2]]+i[e[r+3]]+"-"+i[e[r+4]]+i[e[r+5]]+"-"+i[e[r+6]]+i[e[r+7]]+"-"+i[e[r+8]]+i[e[r+9]]+"-"+i[e[r+10]]+i[e[r+11]]+i[e[r+12]]+i[e[r+13]]+i[e[r+14]]+i[e[r+15]]).toLowerCase()}(p)}},91043:e=>{e.exports=require("@aws-sdk/client-s3")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")},96330:e=>{e.exports=require("@prisma/client")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[7991,2692,1135,3831,4714,3188],()=>t(47706));module.exports=o})();