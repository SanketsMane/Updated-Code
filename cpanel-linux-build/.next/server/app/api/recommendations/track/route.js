"use strict";(()=>{var e={};e.id=9002,e.ids=[9002],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{e.exports=require("node:buffer")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14985:e=>{e.exports=require("dns")},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},37067:e=>{e.exports=require("node:http")},43727:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>w,routeModule:()=>x,serverHooks:()=>y,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{GET:()=>l,POST:()=>d});var o=t(36639),n=t(99880),a=t(77991),i=t(11246),u=t(49522),p=t(11338),c=t(37086);async function d(e){try{let r=await u.j.api.getSession({headers:await t.e(3831).then(t.bind(t,43831)).then(e=>e.headers())});if(!r?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{type:s,courseId:o,category:n,searchQuery:a,duration:d}=await e.json();if(!["View","Enroll","Complete","Search","Like","Share","Download","Rate","Comment"].includes(s))return i.NextResponse.json({error:"Invalid interaction type"},{status:400});return await p.y.trackUserInteraction(r.user.id,{type:s.toLowerCase(),courseId:o,category:n,searchQuery:a,duration:d}),o&&("View"===s||"Enroll"===s)&&await c.z.courseRecommendation.updateMany({where:{userId:r.user.id,courseId:o},data:{viewed:"View"===s||void 0,clicked:!0,enrolled:"Enroll"===s||void 0}}),"Complete"===s&&o&&await c.z.enrollment.updateMany({where:{userId:r.user.id,courseId:o},data:{status:"Active"}}),i.NextResponse.json({success:!0})}catch(e){return console.error("Error tracking interaction:",e),i.NextResponse.json({error:"Failed to track interaction"},{status:500})}}async function l(e){try{let r=await u.j.api.getSession({headers:await t.e(3831).then(t.bind(t,43831)).then(e=>e.headers())});if(!r?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:s}=new URL(e.url),o=parseInt(s.get("days")||"30"),n=new Date(Date.now()-24*o*36e5),a=await c.z.userInteraction.findMany({where:{userId:r.user.id,timestamp:{gte:n}},orderBy:{timestamp:"desc"},include:{course:{select:{title:!0,category:!0}}}}),p={totalInteractions:a.length,byType:a.reduce((e,r)=>(e[r.type]=(e[r.type]||0)+1,e),{}),byCategory:a.filter(e=>e.category||e.course?.category).reduce((e,r)=>{let t=r.category||r.course?.category||"Unknown";return e[t]=(e[t]||0)+1,e},{}),recentSearches:a.filter(e=>"Search"===e.type&&e.searchQuery).slice(0,10).map(e=>({query:e.searchQuery,timestamp:e.timestamp})),engagementScore:function(e){let r={View:1,Search:1,Like:2,Share:3,Enroll:5,Complete:10,Rate:4,Comment:3,Download:2};return Math.min(100,Math.round(e.reduce((e,t)=>e+(r[t.type]||1),0)/1e3*100))}(a)};return i.NextResponse.json({interactions:a.slice(0,100),stats:p})}catch(e){return console.error("Error getting interaction analytics:",e),i.NextResponse.json({error:"Failed to get interaction analytics"},{status:500})}}let x=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/recommendations/track/route",pathname:"/api/recommendations/track",filename:"route",bundlePath:"app/api/recommendations/track/route"},resolvedPagePath:"/Users/sanket/Documents/LMS-Organomed copy/app/api/recommendations/track/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:h,serverHooks:y}=x;function w(){return(0,a.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:h})}},44708:e=>{e.exports=require("node:https")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{e.exports=require("zlib")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},81630:e=>{e.exports=require("http")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")},96330:e=>{e.exports=require("@prisma/client")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7991,2692,1135,4714,1429],()=>t(43727));module.exports=s})();