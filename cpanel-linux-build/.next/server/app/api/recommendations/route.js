"use strict";(()=>{var e={};e.id=2630,e.ids=[2630],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{e.exports=require("node:buffer")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14985:e=>{e.exports=require("dns")},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},37067:e=>{e.exports=require("node:http")},44708:e=>{e.exports=require("node:https")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{e.exports=require("zlib")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},81630:e=>{e.exports=require("http")},90159:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>g,serverHooks:()=>y,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>l});var a=t(36639),i=t(99880),o=t(77991),n=t(11246),p=t(49522),u=t(11338),c=t(37086);async function d(e){try{let r=await p.j.api.getSession({headers:await t.e(3831).then(t.bind(t,43831)).then(e=>e.headers())});if(!r?.user?.id)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:s}=new URL(e.url),a=s.get("userId")||r.user.id,i=s.get("currentCourse")||void 0,o=parseInt(s.get("limit")||"10"),d=await c.z.userPreferences.findUnique({where:{userId:a}}),l=await c.z.userInteraction.findMany({where:{userId:a},orderBy:{timestamp:"desc"},take:50}),g=await c.z.enrollment.findMany({where:{userId:a},select:{courseId:!0}}),m=await c.z.enrollment.findMany({where:{userId:a,status:"Active"},select:{courseId:!0}}),x={userId:a,currentCourse:i,recentActivity:l.map(e=>({type:e.type.toLowerCase(),courseId:e.courseId||void 0,category:e.category||void 0,timestamp:e.timestamp})),completedCourses:m.map(e=>e.courseId),enrolledCourses:g.map(e=>e.courseId),searchHistory:l.filter(e=>"Search"===e.type&&e.searchQuery).map(e=>e.searchQuery).slice(0,10),preferences:{userId:a,categories:d?.categories||[],difficulty:d?.difficulty||[],priceRange:[d?.priceRangeMin||0,d?.priceRangeMax||1e3],learningStyle:d?.learningStyle?.toLowerCase()||"visual",timeAvailability:d?.timeAvailability?.toLowerCase()||"medium",goals:d?.goals||[]}},[y,h,f]=await Promise.all([u.y.getPersonalizedRecommendations(x,o),u.y.getTrendingRecommendations(o),i?u.y.getSimilarCourses(i,Math.min(o,5)):[]]);return await Promise.all([...y.map(e=>c.z.courseRecommendation.upsert({where:{userId_courseId:{userId:a,courseId:e.courseId}},update:{confidence:e.confidence,reasons:e.reasons,tags:e.tags,algorithm:"personalized",expiresAt:new Date(Date.now()+6048e5)},create:{userId:a,courseId:e.courseId,confidence:e.confidence,reasons:e.reasons,tags:e.tags,algorithm:"personalized",expiresAt:new Date(Date.now()+6048e5)}}))]),n.NextResponse.json({personalized:y,trending:h,similar:f,learningPaths:[]})}catch(e){return console.error("Error generating recommendations:",e),n.NextResponse.json({error:"Failed to generate recommendations"},{status:500})}}async function l(e){try{let r=await p.j.api.getSession({headers:await t.e(3831).then(t.bind(t,43831)).then(e=>e.headers())});if(!r?.user?.id)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{preferences:s}=await e.json(),a=await c.z.userPreferences.upsert({where:{userId:r.user.id},update:{categories:s.categories,difficulty:s.difficulty,priceRangeMin:s.priceRange[0],priceRangeMax:s.priceRange[1],learningStyle:s.learningStyle.toUpperCase(),timeAvailability:s.timeAvailability.toUpperCase(),goals:s.goals,topics:s.topics||[],languages:s.languages||["English"]},create:{userId:r.user.id,categories:s.categories,difficulty:s.difficulty,priceRangeMin:s.priceRange[0],priceRangeMax:s.priceRange[1],learningStyle:s.learningStyle.toUpperCase(),timeAvailability:s.timeAvailability.toUpperCase(),goals:s.goals,topics:s.topics||[],languages:s.languages||["English"]}});return n.NextResponse.json({success:!0,preferences:a})}catch(e){return console.error("Error updating preferences:",e),n.NextResponse.json({error:"Failed to update preferences"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/recommendations/route",pathname:"/api/recommendations",filename:"route",bundlePath:"app/api/recommendations/route"},resolvedPagePath:"/Users/sanket/Documents/LMS-Organomed copy/app/api/recommendations/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:x,serverHooks:y}=g;function h(){return(0,o.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:x})}},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")},96330:e=>{e.exports=require("@prisma/client")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7991,2692,1135,4714,1429],()=>t(90159));module.exports=s})();