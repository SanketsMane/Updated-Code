generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                          String                   @id @default(uuid())
  name                        String
  email                       String                   @unique
  emailVerified               Boolean
  image                       String?
  createdAt                   DateTime                 @default(now())
  updatedAt                   DateTime                 @updatedAt
  stripeCustomerId            String?                  @unique
  role                        String?
  banned                      Boolean?
  banReason                   String?
  banExpires                  DateTime?
  bio                         String?
  education                   String?
  blogPosts                   BlogPost[]               @relation("BlogPosts")
  certificates                Certificate[]            @relation("UserCertificates")
  conversationsAsParticipant1 Conversation[]           @relation("ConversationParticipant1")
  conversationsAsParticipant2 Conversation[]           @relation("ConversationParticipant2")
  courses                     Course[]
  enrollment                  Enrollment[]
  groupEnrollments            GroupEnrollment[]        @relation("GroupEnrollments")
  lessonProgress              LessonProgress[]
  studentSessions             LiveSession[]            @relation("StudentSessions")
  receivedMessages            Message[]                @relation("ReceivedMessages")
  sentMessages                Message[]                @relation("SentMessages")
  notifications               Notification[]           @relation("UserNotifications")
  reviewsGiven                Review[]                 @relation("UserReviews")
  sessionBookings             SessionBooking[]         @relation("StudentBookings")
  teacherProfile              TeacherProfile?
  accounts                    Account[]
  recommendations             CourseRecommendation[]
  learningPathEnrollments     LearningPathEnrollment[]
  createdLearningPaths        LearningPath[]
  quizAttempts                QuizAttempt[]
  createdQuizzes              Quiz[]
  sessions                    Session[]
  interactions                UserInteraction[]
  preferences                 UserPreferences?
  videoChatMessages           VideoChatMessage[]       @relation("VideoChatUsers")
  videoParticipation          VideoParticipant[]       @relation("VideoParticipants")
  hostedRooms                 VideoRoom[]              @relation("VideoRoomHost")
  whiteboardElements          WhiteboardElement[]
  whiteboardParticipation     WhiteboardParticipant[]  @relation("WhiteboardParticipants")
  createdWhiteboards          Whiteboard[]             @relation("WhiteboardCreator")

  @@map("user")
}

model Session {
  id             String   @id @default(uuid())
  expiresAt      DateTime
  token          String   @unique
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  ipAddress      String?
  userAgent      String?
  userId         String
  impersonatedBy String?
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Account {
  id                    String    @id @default(uuid())
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("account")
}

model Verification {
  id         String    @id @default(uuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime? @default(now())
  updatedAt  DateTime? @updatedAt

  @@map("verification")
}

model Course {
  id               String                 @id @default(uuid())
  title            String
  description      String
  fileKey          String
  price            Int
  duration         Int
  level            CourseLevel            @default(Beginner)
  stripePriceId    String?                @unique
  category         String
  smallDescription String
  slug             String                 @unique
  status           CourseStatus           @default(Draft)
  language         String?
  tags             String[]
  prerequisites    String?
  learningOutcomes String[]
  isFeatured       Boolean                @default(false)
  discountPrice    Int?
  discountExpiry   DateTime?
  totalStudents    Int                    @default(0)
  averageRating    Float?
  totalReviews     Int                    @default(0)
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  userId           String
  categoryId       String?
  certificates     Certificate[]
  chapter          Chapter[]
  categoryModel    Category?              @relation(fields: [categoryId], references: [id])
  user             User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  enrollment       Enrollment[]
  reviews          Review[]               @relation("CourseReviews")
  recommendations  CourseRecommendation[]
  quizzes          Quiz[]
  interactions     UserInteraction[]
  videoRooms       VideoRoom[]
  whiteboards      Whiteboard[]
}

model Chapter {
  id          String       @id @default(uuid())
  title       String
  position    Int
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  courseId    String
  Course      Course       @relation(fields: [courseId], references: [id], onDelete: Cascade)
  lessons     Lesson[]
  quizzes     Quiz[]
  videoRooms  VideoRoom[]
  whiteboards Whiteboard[]
}

model Lesson {
  id             String           @id @default(uuid())
  title          String
  description    String?
  thumbnailKey   String?
  videoKey       String?
  position       Int
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  chapterId      String
  videoUrl       String?
  Chapter        Chapter          @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  lessonProgress LessonProgress[]
  quizzes        Quiz[]
  videoRooms     VideoRoom[]
  whiteboards    Whiteboard[]
}

model Enrollment {
  id        String           @id @default(uuid())
  amount    Int
  status    EnrollmentStatus @default(Pending)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  courseId  String
  userId    String
  Course    Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  User      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
}

model LessonProgress {
  id        String   @id @default(uuid())
  completed Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String
  lessonId  String
  Lesson    Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, lessonId])
}

model TeacherProfile {
  id                  String                @id @default(uuid())
  userId              String                @unique
  bio                 String?
  expertise           String[]
  languages           String[]
  hourlyRate          Int?
  isVerified          Boolean               @default(false)
  isApproved          Boolean               @default(false)
  availability        Json?
  timezone            String?
  totalEarnings       Decimal               @default(0)
  rating              Float?
  totalReviews        Int                   @default(0)
  totalStudents       Int                   @default(0)
  qualifications      String[]
  certifications      String[]
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  experience          Int?
  commissions         Commission[]
  groupClasses        GroupClass[]
  liveSessions        LiveSession[]
  reviews             Review[]              @relation("TeacherReviews")
  sessionAvailability SessionAvailability[] @relation("TeacherAvailability")
  user                User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  earningsReports     EarningsReport[]      @relation("TeacherEarnings")
  payoutRequests      PayoutRequest[]       @relation("TeacherPayouts")
  verification        TeacherVerification?  @relation("TeacherVerification")
}

model LiveSession {
  id                  String           @id @default(uuid())
  teacherId           String
  studentId           String?
  title               String
  description         String?
  subject             String?
  scheduledAt         DateTime
  duration            Int
  price               Int
  maxParticipants     Int?
  status              SessionStatus    @default(scheduled)
  meetingUrl          String?
  recordingUrl        String?
  notes               String?
  stripePriceId       String?
  stripeSessionId     String?
  timezone            String           @default("UTC")
  isRecurring         Boolean          @default(false)
  recurringPattern    String?
  maxReschedules      Int              @default(2)
  rescheduleCount     Int              @default(0)
  originalScheduledAt DateTime?
  cancelledBy         String?
  cancellationReason  String?
  refundAmount        Int?
  reminderSent        Boolean          @default(false)
  confirmationSent    Boolean          @default(false)
  sessionNotes        String?
  studentRating       Int?
  teacherRating       Int?
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt
  student             User?            @relation("StudentSessions", fields: [studentId], references: [id], onDelete: Cascade)
  teacher             TeacherProfile   @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  bookings            SessionBooking[] @relation("SessionBookings")

  @@index([teacherId, scheduledAt])
  @@index([studentId, scheduledAt])
  @@index([status, scheduledAt])
}

model SessionAvailability {
  id              String         @id @default(uuid())
  teacherId       String
  dayOfWeek       Int
  startTime       String
  endTime         String
  timezone        String         @default("UTC")
  isActive        Boolean        @default(true)
  defaultDuration Int            @default(60)
  bufferTime      Int            @default(15)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  teacher         TeacherProfile @relation("TeacherAvailability", fields: [teacherId], references: [id], onDelete: Cascade)

  @@unique([teacherId, dayOfWeek, startTime, endTime])
  @@index([teacherId, dayOfWeek, isActive])
}

model SessionBooking {
  id                    String        @id @default(uuid())
  sessionId             String
  studentId             String
  status                BookingStatus @default(pending)
  amount                Int
  stripeSessionId       String?       @unique
  stripePaymentIntentId String?
  paymentCompletedAt    DateTime?
  cancelledAt           DateTime?
  cancellationReason    String?
  refundAmount          Int?
  refundedAt            DateTime?
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  session               LiveSession   @relation("SessionBookings", fields: [sessionId], references: [id], onDelete: Cascade)
  student               User          @relation("StudentBookings", fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([sessionId, studentId])
  @@index([sessionId, studentId])
  @@index([studentId, status])
}

model GroupClass {
  id          String            @id @default(uuid())
  teacherId   String
  title       String
  description String
  subject     String?
  level       String?
  language    String?
  scheduledAt DateTime
  duration    Int
  maxStudents Int               @default(20)
  price       Int
  status      ClassStatus       @default(Scheduled)
  meetingUrl  String?
  materials   String[]
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  teacher     TeacherProfile    @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  enrollments GroupEnrollment[]
}

model GroupEnrollment {
  id         String     @id @default(uuid())
  classId    String
  studentId  String
  enrolledAt DateTime   @default(now())
  class      GroupClass @relation(fields: [classId], references: [id], onDelete: Cascade)
  student    User       @relation("GroupEnrollments", fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([classId, studentId])
}

model Review {
  id         String          @id @default(uuid())
  courseId   String?
  teacherId  String?
  reviewerId String
  rating     Int             @db.SmallInt
  title      String?
  comment    String?
  isVerified Boolean         @default(false)
  isHelpful  Int             @default(0)
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
  course     Course?         @relation("CourseReviews", fields: [courseId], references: [id], onDelete: Cascade)
  reviewer   User            @relation("UserReviews", fields: [reviewerId], references: [id], onDelete: Cascade)
  teacher    TeacherProfile? @relation("TeacherReviews", fields: [teacherId], references: [id], onDelete: Cascade)
}

model Category {
  id           String     @id @default(uuid())
  name         String     @unique
  slug         String     @unique
  description  String?
  icon         String?
  image        String?
  parentId     String?
  isActive     Boolean    @default(true)
  displayOrder Int        @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  parent       Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children     Category[] @relation("CategoryHierarchy")
  courses      Course[]
}

model Tag {
  id        String   @id @default(uuid())
  name      String   @unique
  slug      String   @unique
  color     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Commission {
  id                String            @id @default(uuid())
  teacherId         String
  courseId          String?
  sessionId         String?
  type              CommissionType
  amount            Int
  commission        Int
  netAmount         Int
  status            PayoutStatus      @default(Pending)
  paidAt            DateTime?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  teacher           TeacherProfile    @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  payoutCommissions PayoutCommission? @relation("PayoutCommissions")
}

model Notification {
  id        String           @id @default(uuid())
  userId    String
  title     String
  message   String
  type      NotificationType
  isRead    Boolean          @default(false)
  data      Json?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  user      User             @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)
}

model Conversation {
  id             String    @id @default(uuid())
  participant1Id String
  participant2Id String
  title          String?
  isGroup        Boolean   @default(false)
  lastMessageId  String?   @unique
  lastActivity   DateTime  @default(now())
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  lastMessage    Message?  @relation("ConversationLastMessage", fields: [lastMessageId], references: [id])
  participant1   User      @relation("ConversationParticipant1", fields: [participant1Id], references: [id], onDelete: Cascade)
  participant2   User      @relation("ConversationParticipant2", fields: [participant2Id], references: [id], onDelete: Cascade)
  messages       Message[] @relation("ConversationMessages")

  @@unique([participant1Id, participant2Id])
}

model Message {
  id                      String        @id @default(uuid())
  senderId                String
  receiverId              String
  conversationId          String
  content                 String
  messageType             MessageType   @default(Text)
  attachments             Json?
  isRead                  Boolean       @default(false)
  isEdited                Boolean       @default(false)
  parentId                String?
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
  conversationLastMessage Conversation? @relation("ConversationLastMessage")
  conversation            Conversation  @relation("ConversationMessages", fields: [conversationId], references: [id], onDelete: Cascade)
  parent                  Message?      @relation("MessageThread", fields: [parentId], references: [id])
  replies                 Message[]     @relation("MessageThread")
  receiver                User          @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  sender                  User          @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
}

model Certificate {
  id                String   @id @default(uuid())
  userId            String
  courseId          String?
  certificateNumber String   @unique
  templateId        String?
  issuedAt          DateTime @default(now())
  studentName       String
  courseName        String
  teacherName       String
  completionDate    DateTime
  verificationUrl   String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  course            Course?  @relation(fields: [courseId], references: [id])
  user              User     @relation("UserCertificates", fields: [userId], references: [id], onDelete: Cascade)
}

model BlogPost {
  id              String        @id @default(uuid())
  title           String
  slug            String        @unique
  excerpt         String?
  content         String
  authorId        String
  categoryId      String?
  featuredImage   String?
  isPublished     Boolean       @default(false)
  publishedAt     DateTime?
  views           Int           @default(0)
  likes           Int           @default(0)
  metaTitle       String?
  metaDescription String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  author          User          @relation("BlogPosts", fields: [authorId], references: [id], onDelete: Cascade)
  category        BlogCategory? @relation(fields: [categoryId], references: [id])
  tags            BlogTag[]     @relation("BlogPostTags")
}

model BlogCategory {
  id          String     @id @default(uuid())
  name        String     @unique
  slug        String     @unique
  description String?
  color       String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  posts       BlogPost[]
}

model BlogTag {
  id        String     @id @default(uuid())
  name      String     @unique
  slug      String     @unique
  color     String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  posts     BlogPost[] @relation("BlogPostTags")
}

model SiteSettings {
  id             String   @id @default(uuid())
  siteName       String
  siteUrl        String
  logo           String?
  favicon        String?
  contactEmail   String?
  contactPhone   String?
  contactAddress String?
  facebook       String?
  twitter        String?
  instagram      String?
  linkedin       String?
  youtube        String?
  updatedAt      DateTime @updatedAt
}

model Page {
  id              String   @id @default(uuid())
  title           String
  slug            String   @unique
  content         String
  isPublished     Boolean  @default(false)
  metaTitle       String?
  metaDescription String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Testimonial {
  id         String   @id @default(uuid())
  name       String
  role       String
  content    String
  image      String?
  isFeatured Boolean  @default(false)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model UserPreferences {
  id               String           @id @default(cuid())
  userId           String           @unique
  categories       String[]
  difficulty       String[]
  priceRangeMin    Float?           @default(0)
  priceRangeMax    Float?           @default(1000)
  learningStyle    LearningStyle    @default(Visual)
  timeAvailability TimeAvailability @default(Medium)
  goals            String[]
  topics           String[]
  languages        String[]
  notifications    Boolean          @default(true)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  user             User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_preferences")
}

model UserInteraction {
  id          String          @id @default(cuid())
  userId      String
  type        InteractionType
  courseId    String?
  category    String?
  searchQuery String?
  duration    Int?
  metadata    Json?
  timestamp   DateTime        @default(now())
  course      Course?         @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, timestamp])
  @@index([courseId])
  @@index([type])
  @@map("user_interactions")
}

model CourseRecommendation {
  id         String   @id @default(cuid())
  userId     String
  courseId   String
  confidence Float
  reasons    String[]
  tags       String[]
  algorithm  String
  viewed     Boolean  @default(false)
  clicked    Boolean  @default(false)
  enrolled   Boolean  @default(false)
  createdAt  DateTime @default(now())
  expiresAt  DateTime
  course     Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@index([userId, createdAt])
  @@index([expiresAt])
  @@map("course_recommendations")
}

model LearningPath {
  id                String                   @id @default(cuid())
  title             String
  description       String?
  category          String
  difficulty        String
  estimatedDuration Int?
  courses           Json
  prerequisites     Json?
  tags              String[]
  isPublic          Boolean                  @default(true)
  createdById       String
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt
  enrollments       LearningPathEnrollment[]
  createdBy         User                     @relation(fields: [createdById], references: [id])

  @@map("learning_paths")
}

model LearningPathEnrollment {
  id             String       @id @default(cuid())
  userId         String
  learningPathId String
  progress       Json
  currentCourse  String?
  completedAt    DateTime?
  enrolledAt     DateTime     @default(now())
  learningPath   LearningPath @relation(fields: [learningPathId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, learningPathId])
  @@map("learning_path_enrollments")
}

model Quiz {
  id                 String         @id @default(cuid())
  title              String
  description        String?
  instructions       String?
  courseId           String?
  chapterId          String?
  lessonId           String?
  createdById        String
  timeLimit          Int?
  passingScore       Int            @default(70)
  maxAttempts        Int            @default(3)
  showResults        Boolean        @default(true)
  showCorrectAnswers Boolean        @default(false)
  randomizeQuestions Boolean        @default(false)
  randomizeOptions   Boolean        @default(false)
  availableFrom      DateTime?
  availableTo        DateTime?
  isPublished        Boolean        @default(false)
  isActive           Boolean        @default(true)
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  analytics          QuizAnalytics?
  attempts           QuizAttempt[]
  questions          QuizQuestion[]
  chapter            Chapter?       @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  course             Course?        @relation(fields: [courseId], references: [id], onDelete: Cascade)
  createdBy          User           @relation(fields: [createdById], references: [id])
  lesson             Lesson?        @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@map("quizzes")
}

model QuizQuestion {
  id            String          @id @default(cuid())
  quizId        String
  type          QuestionType
  question      String
  explanation   String?
  points        Int             @default(1)
  difficulty    DifficultyLevel @default(Medium)
  position      Int
  questionData  Json
  isRequired    Boolean         @default(true)
  partialCredit Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  quiz          Quiz            @relation(fields: [quizId], references: [id], onDelete: Cascade)
  responses     QuizResponse[]

  @@index([quizId, position])
  @@map("quiz_questions")
}

model QuizAttempt {
  id            String         @id @default(cuid())
  quizId        String
  userId        String
  attemptNumber Int
  status        AttemptStatus  @default(InProgress)
  totalPoints   Int            @default(0)
  maxPoints     Int            @default(0)
  percentage    Float          @default(0)
  passed        Boolean        @default(false)
  startedAt     DateTime       @default(now())
  submittedAt   DateTime?
  timeSpent     Int?
  timeLimit     Int?
  passingScore  Int
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  quiz          Quiz           @relation(fields: [quizId], references: [id], onDelete: Cascade)
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  responses     QuizResponse[]

  @@unique([quizId, userId, attemptNumber])
  @@index([userId, createdAt])
  @@map("quiz_attempts")
}

model QuizResponse {
  id            String       @id @default(cuid())
  attemptId     String
  questionId    String
  answer        Json
  isCorrect     Boolean      @default(false)
  pointsAwarded Float        @default(0)
  timeTaken     Int?
  feedback      String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  attempt       QuizAttempt  @relation(fields: [attemptId], references: [id], onDelete: Cascade)
  question      QuizQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@unique([attemptId, questionId])
  @@map("quiz_responses")
}

model QuizAnalytics {
  id                     String   @id @default(cuid())
  quizId                 String   @unique
  totalAttempts          Int      @default(0)
  uniqueUsers            Int      @default(0)
  averageScore           Float    @default(0)
  passRate               Float    @default(0)
  averageTime            Int      @default(0)
  questionStats          Json
  difficultyDistribution Json
  lastCalculated         DateTime @default(now())
  quiz                   Quiz     @relation(fields: [quizId], references: [id], onDelete: Cascade)

  @@map("quiz_analytics")
}

model Whiteboard {
  id               String                  @id @default(cuid())
  title            String
  description      String?
  courseId         String?
  chapterId        String?
  lessonId         String?
  sessionId        String?
  isPublic         Boolean                 @default(false)
  isLocked         Boolean                 @default(false)
  allowDrawing     Boolean                 @default(true)
  allowText        Boolean                 @default(true)
  allowShapes      Boolean                 @default(true)
  allowImages      Boolean                 @default(true)
  allowAnnotations Boolean                 @default(true)
  width            Int                     @default(1920)
  height           Int                     @default(1080)
  backgroundColor  String                  @default("#ffffff")
  maxParticipants  Int?
  createdById      String
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @updatedAt
  elements         WhiteboardElement[]
  participants     WhiteboardParticipant[]
  sessions         WhiteboardSession[]
  chapter          Chapter?                @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  course           Course?                 @relation(fields: [courseId], references: [id], onDelete: Cascade)
  createdBy        User                    @relation("WhiteboardCreator", fields: [createdById], references: [id])
  lesson           Lesson?                 @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@map("whiteboards")
}

model WhiteboardElement {
  id           String      @id @default(cuid())
  whiteboardId String
  elementId    String
  type         ElementType
  x            Float
  y            Float
  width        Float?
  height       Float?
  strokeColor  String      @default("#000000")
  fillColor    String?
  strokeWidth  Float       @default(2)
  opacity      Float       @default(1)
  data         Json
  version      Int         @default(1)
  createdById  String
  isDeleted    Boolean     @default(false)
  deletedAt    DateTime?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  createdBy    User        @relation(fields: [createdById], references: [id])
  whiteboard   Whiteboard  @relation(fields: [whiteboardId], references: [id], onDelete: Cascade)

  @@unique([whiteboardId, elementId])
  @@map("whiteboard_elements")
}

model WhiteboardSession {
  id           String                  @id @default(cuid())
  whiteboardId String
  sessionName  String?
  isActive     Boolean                 @default(true)
  canDraw      Boolean                 @default(true)
  canEdit      Boolean                 @default(false)
  canDelete    Boolean                 @default(false)
  startedAt    DateTime                @default(now())
  endedAt      DateTime?
  participants WhiteboardParticipant[]
  whiteboard   Whiteboard              @relation(fields: [whiteboardId], references: [id], onDelete: Cascade)

  @@map("whiteboard_sessions")
}

model WhiteboardParticipant {
  id           String             @id @default(cuid())
  whiteboardId String
  sessionId    String?
  userId       String
  role         ParticipantRole    @default(Viewer)
  cursorColor  String             @default("#007bff")
  isOnline     Boolean            @default(false)
  lastSeen     DateTime           @default(now())
  cursorX      Float?
  cursorY      Float?
  joinedAt     DateTime           @default(now())
  leftAt       DateTime?
  session      WhiteboardSession? @relation(fields: [sessionId], references: [id])
  user         User               @relation("WhiteboardParticipants", fields: [userId], references: [id])
  whiteboard   Whiteboard         @relation(fields: [whiteboardId], references: [id], onDelete: Cascade)

  @@unique([whiteboardId, userId])
  @@map("whiteboard_participants")
}

model VideoRoom {
  id                     String             @id @default(cuid())
  roomId                 String             @unique
  title                  String
  description            String?
  hostId                 String
  courseId               String?
  chapterId              String?
  lessonId               String?
  scheduledFor           DateTime?
  duration               Int                @default(60)
  maxParticipants        Int?
  isRecordingEnabled     Boolean            @default(false)
  isScreenSharingEnabled Boolean            @default(true)
  isWhiteboardEnabled    Boolean            @default(true)
  isChatEnabled          Boolean            @default(true)
  isPrivate              Boolean            @default(false)
  waitingRoomEnabled     Boolean            @default(false)
  requireModerator       Boolean            @default(false)
  autoRecord             Boolean            @default(false)
  quality                VideoQuality       @default(MEDIUM)
  status                 RoomStatus         @default(WAITING)
  startedAt              DateTime?
  endedAt                DateTime?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt
  chatMessages           VideoChatMessage[]
  participants           VideoParticipant[]
  recordings             VideoRecording[]
  chapter                Chapter?           @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  course                 Course?            @relation(fields: [courseId], references: [id], onDelete: Cascade)
  host                   User               @relation("VideoRoomHost", fields: [hostId], references: [id], onDelete: Cascade)
  lesson                 Lesson?            @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@map("video_rooms")
}

model VideoParticipant {
  id                String            @id @default(cuid())
  roomId            String
  userId            String
  role              VideoRole         @default(PARTICIPANT)
  isVideoOn         Boolean           @default(true)
  isAudioOn         Boolean           @default(true)
  isScreenSharing   Boolean           @default(false)
  isHandRaised      Boolean           @default(false)
  connectionQuality ConnectionQuality @default(GOOD)
  joinedAt          DateTime          @default(now())
  leftAt            DateTime?
  room              VideoRoom         @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user              User              @relation("VideoParticipants", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([roomId, userId])
  @@map("video_participants")
}

model VideoRecording {
  id        String       @id @default(cuid())
  roomId    String
  title     String?
  filename  String
  fileUrl   String
  fileSize  BigInt?
  duration  Int?
  quality   VideoQuality @default(MEDIUM)
  startedAt DateTime     @default(now())
  endedAt   DateTime?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  room      VideoRoom    @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@map("video_recordings")
}

model VideoChatMessage {
  id        String          @id @default(cuid())
  roomId    String
  userId    String
  message   String
  type      ChatMessageType @default(MESSAGE)
  fileUrl   String?
  fileName  String?
  fileSize  BigInt?
  createdAt DateTime        @default(now())
  room      VideoRoom       @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user      User            @relation("VideoChatUsers", fields: [userId], references: [id], onDelete: Cascade)

  @@map("video_chat_messages")
}

model TeacherVerification {
  id                       String             @id @default(cuid())
  teacherId                String             @unique
  status                   VerificationStatus @default(Pending)
  verificationLevel        VerificationLevel  @default(Basic)
  identityDocumentType     String?
  identityDocumentUrl      String?
  identityVerifiedAt       DateTime?
  qualificationDocuments   String[]
  qualificationsVerifiedAt DateTime?
  experienceDocuments      String[]
  experienceYears          Int?
  experienceVerifiedAt     DateTime?
  bankAccountName          String?
  bankAccountNumber        String?
  bankRoutingNumber        String?
  bankVerifiedAt           DateTime?
  backgroundCheckProvider  String?
  backgroundCheckStatus    String?
  backgroundCheckDate      DateTime?
  adminNotes               String?
  rejectionReason          String?
  submittedAt              DateTime?
  reviewedAt               DateTime?
  approvedAt               DateTime?
  rejectedAt               DateTime?
  reviewedById             String?
  createdAt                DateTime           @default(now())
  updatedAt                DateTime           @updatedAt
  teacher                  TeacherProfile     @relation("TeacherVerification", fields: [teacherId], references: [id], onDelete: Cascade)

  @@map("teacher_verifications")
}

model PayoutRequest {
  id                String              @id @default(cuid())
  teacherId         String
  requestedAmount   Decimal
  currency          String              @default("USD")
  bankAccountName   String
  bankAccountNumber String
  bankRoutingNumber String?
  bankName          String?
  bankAddress       String?
  swiftCode         String?
  status            PayoutRequestStatus @default(Pending)
  processedAmount   Decimal?
  processingFee     Decimal?
  netAmount         Decimal?
  paymentMethodId   String?
  transactionId     String?
  verifiedAt        DateTime?
  approvedAt        DateTime?
  processedAt       DateTime?
  rejectedAt        DateTime?
  adminNotes        String?
  rejectionReason   String?
  processedById     String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  commissions       PayoutCommission[]
  teacher           TeacherProfile      @relation("TeacherPayouts", fields: [teacherId], references: [id], onDelete: Cascade)

  @@index([teacherId, status])
  @@index([status, createdAt])
  @@map("payout_requests")
}

model PayoutCommission {
  id              String        @id @default(cuid())
  payoutRequestId String
  commissionId    String        @unique
  amount          Decimal
  createdAt       DateTime      @default(now())
  commission      Commission    @relation("PayoutCommissions", fields: [commissionId], references: [id], onDelete: Cascade)
  payoutRequest   PayoutRequest @relation(fields: [payoutRequestId], references: [id], onDelete: Cascade)

  @@map("payout_commissions")
}

model EarningsReport {
  id                  String         @id @default(cuid())
  teacherId           String
  periodStart         DateTime
  periodEnd           DateTime
  reportType          ReportType     @default(Monthly)
  totalEarnings       Decimal        @default(0)
  courseEarnings      Decimal        @default(0)
  sessionEarnings     Decimal        @default(0)
  platformFee         Decimal        @default(0)
  netEarnings         Decimal        @default(0)
  totalTransactions   Int            @default(0)
  courseTransactions  Int            @default(0)
  sessionTransactions Int            @default(0)
  isProcessed         Boolean        @default(false)
  processedAt         DateTime?
  metadata            Json?
  generatedAt         DateTime       @default(now())
  teacher             TeacherProfile @relation("TeacherEarnings", fields: [teacherId], references: [id], onDelete: Cascade)

  @@unique([teacherId, periodStart, periodEnd, reportType])
  @@map("earnings_reports")
}

enum CourseLevel {
  Beginner
  Intermediate
  Advanced
}

enum CourseStatus {
  Draft
  Pending
  Published
  Archived
}

enum EnrollmentStatus {
  Pending
  Active
  Cancelled
}

enum SessionStatus {
  scheduled
  in_progress
  completed
  cancelled
  no_show
}

enum BookingStatus {
  pending
  confirmed
  cancelled
  refunded
}

enum ClassStatus {
  Scheduled
  InProgress
  Completed
  Cancelled
}

enum CommissionType {
  Course
  LiveSession
  GroupClass
}

enum PayoutStatus {
  Pending
  Processing
  Paid
  Failed
}

enum NotificationType {
  System
  Course
  Session
  Payment
  Review
  Message
}

enum MessageType {
  Text
  Image
  File
  Video
  Audio
}

enum QuestionType {
  MultipleChoice
  TrueFalse
  ShortAnswer
  LongAnswer
  FillInTheBlank
  Matching
  Ordering
  Drag
}

enum DifficultyLevel {
  Easy
  Medium
  Hard
  Expert
}

enum AttemptStatus {
  InProgress
  Completed
  Submitted
  Graded
  Failed
}

enum InteractionType {
  View
  Enroll
  Complete
  Search
  Like
  Share
  Download
  Rate
  Comment
}

enum LearningStyle {
  Visual
  Auditory
  Kinesthetic
  Reading
}

enum TimeAvailability {
  Low
  Medium
  High
}

enum ElementType {
  Pen
  Line
  Rectangle
  Circle
  Arrow
  Text
  Image
  Sticky
  Shape
  Highlight
  Eraser
}

enum ParticipantRole {
  Owner
  Moderator
  Collaborator
  Viewer
}

enum VideoQuality {
  LOW
  MEDIUM
  HIGH
  HD
}

enum RoomStatus {
  WAITING
  ACTIVE
  ENDED
}

enum VideoRole {
  HOST
  MODERATOR
  PARTICIPANT
}

enum ConnectionQuality {
  POOR
  FAIR
  GOOD
  EXCELLENT
}

enum ChatMessageType {
  MESSAGE
  SYSTEM
  FILE
}

enum VerificationStatus {
  Pending
  UnderReview
  Approved
  Rejected
  Suspended
}

enum VerificationLevel {
  Basic
  Identity
  Qualified
  Professional
  Premium
}

enum PayoutRequestStatus {
  Pending
  UnderReview
  Approved
  Processing
  Completed
  Failed
  Rejected
  Cancelled
}

enum ReportType {
  Daily
  Weekly
  Monthly
  Quarterly
  Yearly
}
